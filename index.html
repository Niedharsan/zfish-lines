<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Zebrafish Resources</title>
<link rel="stylesheet" href="https://cdn.datatables.net/1.13.8/css/jquery.dataTables.min.css">
<style>
  :root { --gold:#D4AF37; --bg:#000; --text:#EEE; }
  html, body { background: var(--bg); color: var(--text); margin:0; font-family: system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; }
  .wrap { max-width: 1100px; margin: 0 auto; padding: 20px 16px 40px; }
  h1 { color: var(--gold); font-weight: 800; letter-spacing: 0.3px; font-size: clamp(24px, 4vw, 36px); margin: 8px 0 6px; }
  p.lead { color:#BEBEBE; margin:6px 0 10px; font-size: 15px; }
  .searchbar { display:flex; gap:10px; margin: 10px 0 16px; align-items:center; }
  .searchbar input { flex:1; background:#111; border:1.5px solid #333; color:#EEE; padding:10px 12px; border-radius:10px; font-size:16px; }
  .tabs { display:flex; gap:10px; flex-wrap:wrap; margin: 10px 0 12px; }
  .tabbtn { background: transparent; border: 1.6px solid var(--gold); color: var(--gold); padding: 10px 14px; border-radius: 999px; cursor:pointer; font-weight:700; display:flex; gap:8px; align-items:center; }
  .tabbtn.active { background: var(--gold); color: #000; }
  .badge { background:#1a1a1a; color:var(--gold); border:1px solid var(--gold); padding:2px 8px; border-radius:999px; font-size:12px; }
  .panel { display:none; }
  .panel.active { display:block; }
  table.dataTable { background:#0a0a0a; border-radius:12px; overflow:hidden; width:100%; table-layout: fixed; }
  table.dataTable thead th { color: var(--gold); white-space: normal !important; }
  table.dataTable tbody td { color:#EDEDED; white-space: normal !important; word-wrap: break-word; }
  .dt-container .dt-search, .dt-container .dt-length, .dt-container .dt-paging { display:none !important; }
  .scroll-wrap { max-height: 70vh; }
  footer { color:#777; margin-top: 18px; font-size: 13px; }
</style>
</head>
<body>
<div class="wrap">
  <h1>Zebrafish Resources</h1>
  <p class="lead">One search box filters <em>all</em> tabs. Two-column, scrollable tables. Transgenics merged into one list.</p>

  <div class="searchbar">
    <input id="globalSearch" type="search" placeholder="Search all..." aria-label="Search all tables">
  </div>

  <div class="tabs">
    <button class="tabbtn active" data-tab="crisprs">CRISPRs <span class="badge" id="badge-crisprs">0</span></button>
    <button class="tabbtn" data-tab="transgenics">Transgenics <span class="badge" id="badge-tg">0</span></button>
    <button class="tabbtn" data-tab="mutants">Mutant Lines <span class="badge" id="badge-mutants">0</span></button>
  </div>

  <section id="crisprs" class="panel active">
    <div class="scroll-wrap"><table id="crispr-table" class="display" style="width:100%"></table></div>
  </section>

  <section id="transgenics" class="panel">
    <div class="scroll-wrap"><table id="tg-table" class="display" style="width:100%"></table></div>
  </section>

  <section id="mutants" class="panel">
    <div class="scroll-wrap"><table id="mutants-table" class="display" style="width:100%"></table></div>
  </section>

  <footer>Only the first two columns in each CSV are shown as Name/Details.</footer>
</div>

<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
<script src="https://cdn.datatables.net/1.13.8/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
// Persistent global filter that runs for ALL tables
let GLOBAL_TERM = '';
$.fn.dataTable.ext.search.push(function(settings, data) {
  if (!GLOBAL_TERM) return true;
  const text = (data || []).join(' ').toLowerCase();
  return text.indexOf(GLOBAL_TERM) !== -1;
});

const tables = {};

function toRows(data) {
  const rows = [];
  for (const obj of data) {
    const keys = Object.keys(obj);
    if (!keys.length) continue;
    const k1 = keys[0];
    const k2 = keys.length > 1 ? keys[1] : keys[0];
    rows.push({ Name: String(obj[k1] ?? '').trim(), Details: String(obj[k2] ?? '').trim() });
  }
  return rows;
}

function build2col(sel, rows) {
  const dt = new DataTable(sel, {
    data: rows,
    columns: [
      { title: 'Name', data: 'Name', width: '35%' },
      { title: 'Details', data: 'Details', width: '65%' }
    ],
    responsive: false,
    autoWidth: false,
    paging: false,
    info: false,
    searching: false,
    order: [[0, 'asc']],
    scrollY: '60vh',
    scrollCollapse: true
  });
  // Apply current global term immediately after init
  dt.draw();
  return dt;
}

function updateBadges() {
  const count = (dt) => dt ? dt.rows({ filter: 'applied' }).count() : 0;
  document.getElementById('badge-crisprs').textContent = count(tables.crispr);
  document.getElementById('badge-tg').textContent = count(tables.tg);
  document.getElementById('badge-mutants').textContent = count(tables.mutants);
}

function relayout() {
  Object.values(tables).forEach(dt => { if (dt) { dt.columns.adjust(); dt.draw(false); }});
}

// Tabs
document.querySelectorAll('.tabbtn').forEach(btn => {
  btn.addEventListener('click', () => {
    document.querySelectorAll('.tabbtn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    const id = btn.dataset.tab;
    document.querySelectorAll('.panel').forEach(p => p.classList.remove('active'));
    document.getElementById(id).classList.add('active');
    relayout();
  });
});

// Global search handler
document.getElementById('globalSearch').addEventListener('input', (e) => {
  GLOBAL_TERM = (e.target.value || '').toLowerCase();
  Object.values(tables).forEach(dt => { if (dt) dt.draw(); });
  updateBadges();
});

// Load CSVs
Papa.parse('crisprs.csv', { download:true, header:true, skipEmptyLines:true, complete: (res) => {
  tables.crispr = build2col('#crispr-table', toRows(res.data || []));
  updateBadges();
}});
Papa.parse('transgenics.csv', { download:true, header:true, skipEmptyLines:true, complete: (res) => {
  tables.tg = build2col('#tg-table', toRows(res.data || []));
  updateBadges();
}});
Papa.parse('mutants.csv', { download:true, header:true, skipEmptyLines:true, complete: (res) => {
  tables.mutants = build2col('#mutants-table', toRows(res.data || []));
  updateBadges();
}});
</script>
</body>
</html>
